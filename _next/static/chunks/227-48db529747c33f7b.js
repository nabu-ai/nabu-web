"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[227],{7989:function(e,n,t){t.r(n),t.d(n,{generateTranslationAudio:function(){return z},pauseMicrophoneRecording:function(){return X},prepareStreaming:function(){return Q},processMicrophone:function(){return F},resumeMicrophoneRecording:function(){return q},stopMicrophoneRecording:function(){return Z},supportedLanguages:function(){return J},translate:function(){return j},version:function(){return K}});const a={"en-AU":"English (Australian)","en-GB":"English (British)","en-NZ":"English (New Zealand)","en-US":"English (US)","fr-FR":"French","fr-CA":"French (Canadian)","de-DE":"German","it-IT":"Italian","ja-JP":"Japanese","ko-KR":"Korean","pt-BR":"Portuguese (Brazilian)","es-ES":"Spanish (European)","es-US":"Spanish (US)"},r={...a,arb:"Arabic","ar-AE":"Arabic (Gulf)","ca-ES":"Catalan","yue-CN":"Chinese (Cantonese)","cmn-CN":"Chinese (Mandarin)","cs-CZ":"Czech","da-DK":"Danish","nl-BE":"Dutch (Belgian)","nl-NL":"Dutch","en-AU":"English (Australian)","en-GB":"English (British)","en-IN":"English (Indian)","en-NZ":"English (New Zealand)","en-SG":"English (Singaporean)","en-ZA":"English (South African)","en-US":"English (US)","en-GB-WLS":"English (Welsh)","fi-FI":"Finnish","fr-FR":"French","fr-BE":"French (Belgian)","fr-CA":"French (Canadian)","hi-IN":"Hindi","de-DE":"German","de-AT":"German (Austrian)","de-CH":"German (Swiss standard)","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","ko-KR":"Korean","nb-NO":"Norwegian","pl-PL":"Polish","pt-BR":"Portuguese (Brazilian)","pt-PT":"Portuguese (European)","ro-RO":"Romanian","ru-RU":"Russian","es-ES":"Spanish (Spain)","es-MX":"Spanish (Mexican)","es-US":"Spanish (US)","sv-SE":"Swedish","tr-TR":"Turkish","cy-GB":"Welsh"},o={"en-US":"en-US_Telephony","en-GB":"en-GB_Telephony","en-AU":"en-AU_Telephony","es-ES":"es-ES_Telephony","es-LA":"es-LA_Telephony","fr-FR":"fr-FR_Telephony","fr-CA":"fr-CA_Telephony","de-DE":"de-DE_Telephony","it-IT":"it-IT_Telephony","pt-BR":"pt-BR_Telephony","ja-JP":"ja-JP_Telephony","nl-NL":"nl-NL_Telephony","ko-KR":"ko-KR_Telephony","zh-CN":"zh-CN_Telephony"};class i{async start(e){let{onTranscription:n,onError:t,onComplete:a,onConnected:r}=e;try{const e=this.buildWebSocketUrl();this.ws=new WebSocket(e),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{console.log("Stream Opened:::",(new Date).toLocaleTimeString()),this.ws.send(JSON.stringify({action:"start","content-type":"audio/l16;rate=8000;channels=1",interim_results:!0,smart_formatting:!0,inactivity_timeout:-1})),r&&r()},this.ws.onmessage=e=>{const t=JSON.parse(e.data);if(t.results&&t.results.length>0&&t.results[0].final){const e=t.results[0].alternatives[0];n({transcript:e.transcript,timestamps:e.timestamps,confidence:e.confidence,labels:t.speaker_labels})}},this.ws.onerror=e=>{t&&t(e),console.error("[NABU] StreamingV1 error",e)},this.ws.onclose=()=>{a&&a(),console.log("[NABU] [StreamingV1] closed")},this.stream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:this.sampleRate}}),this.audioContext=new AudioContext({sampleRate:this.sampleRate}),await this.audioContext.audioWorklet.addModule("./silence-processor.js");const o=this.audioContext.createMediaStreamSource(this.stream);this.processorNode=new AudioWorkletNode(this.audioContext,"silence-detector",{processorOptions:{silenceThreshold:.02,silenceDuration:300,sampleRate:this.sampleRate}}),this.processorNode.port.onmessage=e=>{const{type:n,payload:t}=e.data;"silence"!==n||this.isSilent?"speaking"===n&&this.isSilent?(this.isSilent=!1,this.stopSendingSilence()):"pcm"!==n||this.isSilent||this.ws.readyState!==WebSocket.OPEN||this.ws.send(new Uint8Array(t)):(this.isSilent=!0,this.startSendingSilence())},o.connect(this.processorNode),this.processorNode.connect(this.audioContext.destination),this.processorNode.port.postMessage({type:"start"}),console.log("Ready to stream::",(new Date).toLocaleTimeString())}catch(o){console.error("StreamingV1 start error:",o),this.onError&&this.onError(o)}}stop(){var e;this.processorNode&&this.processorNode.port.postMessage({type:"stop"}),this.stream&&this.stream.getTracks().forEach((e=>e.stop())),this.audioContext&&this.audioContext.close(),(null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&(this.ws.send(JSON.stringify({action:"stop"})),this.ws.close())}getSilenceBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;const n=this.sampleRate*e/1e3,t=new Int16Array(n);return new Uint8Array(t.buffer)}startSendingSilence(){this.stopSendingSilence();const e=this.getSilenceBuffer(100);this.silenceInterval=setInterval((()=>{this.ws.readyState===WebSocket.OPEN&&this.ws.send(e)}),100)}stopSendingSilence(){this.silenceInterval&&(clearInterval(this.silenceInterval),this.silenceInterval=null)}buildWebSocketUrl(){const e=new URLSearchParams({access_token:this.token,model:this.model,inactivity_timeout:-1});return"".concat("wss://api.us-east.speech-to-text.watson.cloud.ibm.com/instances/866db787-0272-4cdd-9ebe-110e2db04346/v1/recognize","?").concat(e.toString())}constructor({token:e,model:n="en-US_Telephony"}){this.token=e,this.model=n,this.ws=null,this.audioContext=null,this.processorNode=null,this.stream=null,this.sampleRate=8e3,this.silenceInterval=null,this.isSilent=!1}}var s=t(4223),c=t(5796),l=t(3856),d=t.n(l);class u{async start(e,n){let{onData:t,onError:a,onComplete:r,onConnected:o}=n;if(window&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),e){const n=await e.arrayBuffer();this.bufferStream=n;const t=await this.audioContext.decodeAudioData(n),a=t.duration;console.log("Duration::::",a),this.bufferSource=this.audioContext.createBufferSource(),this.bufferSource.buffer=t}else this.audioStreams=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),this.audioSource=this.audioContext.createMediaStreamSource(this.audioStreams);const i={numberOfChannels:1,sampleRate:this.audioContext.sampleRate,maxFrameCount:1*this.audioContext.sampleRate/10};try{await this.audioContext.audioWorklet.addModule("./recording-processor.js"),console.log("connected"),o&&o()}catch(p){console.log("Add module error ".concat(p))}if(this.workletNode=new AudioWorkletNode(this.audioContext,"recording-processor",{processorOptions:i}),this.workletNode.port.postMessage({message:"UPDATE_RECORDING_STATE",setRecording:!0}),e)this.bufferSource.connect(this.workletNode).connect(this.audioContext.destination),this.bufferSource.start(),console.log("starting file");else{const e=this.audioContext.createMediaStreamDestination();this.audioSource.connect(this.workletNode).connect(e)}this.workletNode.port.onmessageerror=e=>{console.log("Error receiving message from worklet ".concat(e)),a&&a(e)};const c=d().iterator(this.workletNode.port,"message"),l=e=>{const n=new ArrayBuffer(2*e.length),t=new DataView(n);for(let a=0;a<e.length;a++){const n=Math.max(-1,Math.min(1,e[a]));t.setInt16(2*a,n<0?32768*n:32767*n,!0)}return n};this.command=new s.W({LanguageCode:this.languageCode,MediaEncoding:"pcm",MediaSampleRateHertz:"48000",AudioStream:async function*(){for await(const e of c)if("SHARE_RECORDING_BUFFER"===e.data.message){const n=l(e.data.buffer[0]),t=new Uint8Array(n);yield{AudioEvent:{AudioChunk:t}}}}()});try{const e=await this.streamingClient.send(this.command);if(e.TranscriptResultStream){for await(const n of e.TranscriptResultStream){var u,g;if(null===n||void 0===n||null===(u=n.TranscriptEvent)||void 0===u?void 0:u.Transcript)for(const e of(null===n||void 0===n||null===(g=n.TranscriptEvent)||void 0===g?void 0:g.Transcript.Results)||[])if((null===e||void 0===e?void 0:e.Alternatives)&&(null===e||void 0===e?void 0:e.Alternatives[0].Items)){var m;let n="";for(let t=0;t<(null===e||void 0===e||null===(m=e.Alternatives[0].Items)||void 0===m?void 0:m.length);t++)n+=" ".concat(null===e||void 0===e?void 0:e.Alternatives[0].Items[t].Content);e.IsPartial||(n.endsWith(" .")&&(n=n.replace(" .",".")),n&&t&&t(n))}}r&&r()}}catch(h){a&&a(h)}}async stop(e){let{onStreamingStopped:n}=e;var t;(this.workletNode&&this.workletNode.port.postMessage({message:"UPDATE_RECORDING_STATE",setRecording:!1}),this.audioSource&&this.audioSource.disconnect(this.workletNode),this.bufferSource&&this.bufferSource.disconnect(this.workletNode),this.workletNode&&this.workletNode.disconnect(),this.streamingClient.destroy(),this.audioStreams)&&(null===(t=this.audioStreams.getTracks())||void 0===t||t.forEach((e=>e.stop())),this.audioStreams=null);this.audioContext&&(await this.audioContext.close(),this.audioContext=null),n&&n()}constructor({region:e,credentials:n,languageCode:t="en-US",sampleRate:a=44100}){this.region=e,this.credentials=n,this.languageCode=t,this.sampleRate=a,this.audioContext=null,this.workletNode=null,this.streamingClient=new c.I({region:e,credentials:n}),this.controller=null,this.audioStreams=null,this.bufferStream=null,this.audioSource=null,this.bufferSource=null}}var g=t(7563),m=t.n(g);const p="https://nabu-0390bfe7dc2f.herokuapp.com",h=async e=>{const n="".concat(p,"/get-token?serviceName=").concat(e);try{return(await m().get(n)).data}catch(t){return console.error("Error fetching access token:",t),null}},f=async()=>{const e="".concat(p,"/get-creds");try{return(await m().get(e)).data}catch(n){return console.error("Error fetching creds:",n),null}};var S=t(7272),v=t(4563);class y{async translateText(e,n,t){try{const a=new S.r({Text:e,SourceLanguageCode:n,TargetLanguageCode:t});return{translation:(await this.translateClient.send(a)).TranslatedText}}catch(a){return{translationError:a}}}constructor({region:e,credentials:n}){this.region=e,this.credentials=n,this.translateClient=new v.O({region:e,credentials:n})}}var w=t(2781),E=t.n(w);class I{async generateSpeech(e){const n=this.getIBMVoiceFromLanguageCode(e.languageCode,e.gender);if(e.voice=n,e.accessToken||(e.accessToken=this.ttsAccessToken),e.autoPlay=!1,!e.text)return{message:"Please input the 'text' param"};if(!e.accessToken)return{message:"Please input 'accessToken' param"};if(!n)return{message:"No voice found for the language code: ".concat(e.languageCode)};try{var t=e.url||"https://api.au-syd.text-to-speech.watson.cloud.ibm.com",a=this.processUserParams(e,["voice","X-Watson-Learning-Opt-Out","text","watson-token","access_token","accept","customization_id"]);const n=await fetch(t+"/v1/synthesize?"+this.stringify(a),{method:"GET"}),r=await n.blob();return r?{audio:r}:{message:"Failed to generate audio"}}catch(r){return{message:r}}}processUserParams(e,n){var t={};return n.forEach((n=>{var a=E()(n);void 0!==e[a]&&(t[n]=e[a])})),t}stringify(e){return Object.keys(e).map((function(n){return n+"="+encodeURIComponent(e[n])})).join("&")}getModelFromLanguageCode(e){return{"de-DE":"de-DE_Multimedia","en-US":"en-US_Multimedia","en-GB":"en-GB_Multimedia","en-AU":"en-AU_Multimedia","es-ES":"es-ES_Multimedia","fr-CA":"fr-CA_Multimedia","fr-FR":"fr-FR_Multimedia","it-IT":"it-IT_Multimedia","ja-JP":"ja-JP_Multimedia","ko-KR":"ko-KR_Multimedia","nl-NL":"nl-NL_Multimedia","pt-BR":"pt-BR_Multimedia"}[e]}getIBMVoiceFromLanguageCode(e,n){const t={"en-US":{male:"en-US_HenryV3Voice",female:"en-US_AllisonV3Voice"},"en-GB":{male:"en-GB_JamesV3Voice",female:"en-GB_KateV3Voice"},"en-AU":{male:"en-AU_JackExpressive",female:"en-AU_HeidiExpressive"},"es-ES":{male:"es-ES_EnriqueV3Voice",female:"es-ES_LauraV3Voice"},"es-LA":{female:"es-LA_SofiaV3Voice"},"es-US":{female:"es-US_SofiaV3Voice"},"fr-FR":{male:"fr-FR_NicolasV3Voice",female:"fr-FR_ReneeV3Voice"},"fr-CA":{female:"fr-CA_LouiseV3Voice"},"de-DE":{male:"de-DE_DieterV3Voice",female:"de-DE_BirgitV3Voice"},"it-IT":{female:"it-IT_FrancescaV3Voice"},"pt-BR":{male:"pt-BR_LucasExpressive",female:"pt-BR_IsabelaV3Voice"},"ja-JP":{female:"ja-JP_EmiV3Voice"},"ko-KR":{female:"ko-KR_JinV3Voice"}}[e];if(!t)return null;if(!n)return t;const a=t[n.toLowerCase()];if(a)return a;return t.male||t.female||null}constructor({sttAccessToken:e,ttsAccessToken:n,languageCode:t="en-US"}){return this.sttAccessToken=e,this.ttsAccessToken=n,this.languageCode=t,this.audioStream=null,I.instance||(I.instance=this),I.instance}}var A=t(1806),C=t(1843);class L{async audioText(e,n,t,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mp3";const o=new A.Q({OutputFormat:r,Text:e,VoiceId:n,Engine:t,LanguageCode:a}),{AudioStream:i}=await this.pollyClient.send(o);return i}async fetchLanguages(){return{"fr-BE":{female:{voiceId:"Isabelle",engine:"neural"}},"en-US":{female:{voiceId:"Danielle",engine:"neural"},male:{voiceId:"Gregory",engine:"neural"}},"tr-TR":{female:{voiceId:"Burcu",engine:"neural"}},"cs-CZ":{female:{voiceId:"Jitka",engine:"neural"}},"de-CH":{female:{voiceId:"Sabrina",engine:"neural"}},"es-ES":{female:{voiceId:"Lucia",engine:"neural"},male:{voiceId:"Sergio",engine:"neural"}},"es-US":{female:{voiceId:"Lupe",engine:"neural"},male:{voiceId:"Pedro",engine:"neural"}},"en-SG":{female:{voiceId:"Jasmine",engine:"neural"}},"ko-KR":{female:{voiceId:"Jihye",engine:"neural"}},"sv-SE":{female:{voiceId:"Elin",engine:"neural"}},"ru-RU":{female:{voiceId:"Tatyana",engine:"standard"},male:{voiceId:"Maxim",engine:"standard"}},"ro-RO":{female:{voiceId:"Carmen",engine:"standard"}},"pt-PT":{female:{voiceId:"Ines",engine:"neural"},male:{voiceId:"Cristiano",engine:"standard"}},"pt-BR":{female:{voiceId:"Vitoria",engine:"neural"},male:{voiceId:"Thiago",engine:"neural"}},"pl-PL":{female:{voiceId:"Ola",engine:"neural"},male:{voiceId:"Jan",engine:"standard"}},"nl-BE":{female:{voiceId:"Lisa",engine:"neural"}},"nl-NL":{male:{voiceId:"Ruben",engine:"standard"},female:{voiceId:"Laura",engine:"neural"}},"nb-NO":{female:{voiceId:"Ida",engine:"neural"}},"ja-JP":{female:{voiceId:"Kazuha",engine:"neural"},male:{voiceId:"Takumi",engine:"neural"}},"it-IT":{female:{voiceId:"Bianca",engine:"neural"},male:{voiceId:"Adriano",engine:"neural"}},"is-IS":{male:{voiceId:"Karl",engine:"standard"},female:{voiceId:"Dora",engine:"standard"}},"fr-FR":{male:{voiceId:"Remi",engine:"neural"},female:{voiceId:"Lea",engine:"neural"}},"fr-CA":{female:{voiceId:"Gabrielle",engine:"neural"},male:{voiceId:"Liam",engine:"neural"}},"es-MX":{female:{voiceId:"Mia",engine:"neural"},male:{voiceId:"Andres",engine:"neural"}},"en-GB-WLS":{male:{voiceId:"Geraint",engine:"standard"}},"en-NZ":{female:{voiceId:"Aria",engine:"neural"}},"en-ZA":{female:{voiceId:"Ayanda",engine:"neural"}},"en-IN":{female:{voiceId:"Kajal",engine:"neural"}},"hi-IN":{female:{voiceId:"Kajal",engine:"neural"}},"en-GB":{female:{voiceId:"Emma",engine:"neural"},male:{voiceId:"Brian",engine:"neural"}},"en-AU":{male:{voiceId:"Russell",engine:"standard"},female:{voiceId:"Olivia",engine:"neural"}},"de-DE":{female:{voiceId:"Vicki",engine:"neural"},male:{voiceId:"Daniel",engine:"neural"}},"da-DK":{female:{voiceId:"Sofie",engine:"neural"},male:{voiceId:"Mads",engine:"standard"}},"cy-GB":{female:{voiceId:"Gwyneth",engine:"standard"}},"cmn-CN":{female:{voiceId:"Zhiyu",engine:"neural"}},arb:{female:{voiceId:"Hala",engine:"neural"},male:{voiceId:"Zayd",engine:"neural"}},"ar-AE":{female:{voiceId:"Hala",engine:"neural"},male:{voiceId:"Zayd",engine:"neural"}},"ca-ES":{female:{voiceId:"Arlet",engine:"neural"}},"de-AT":{female:{voiceId:"Hannah",engine:"neural"}},"yue-CN":{female:{voiceId:"Hiujin",engine:"neural"}},"fi-FI":{female:{voiceId:"Suvi",engine:"neural"}},"en-IE":{female:{voiceId:"Niamh",engine:"neural"}}}}formatVoices(e){const n={},t={neural:3,standard:2,generative:1};function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t[e.toLowerCase()]||0}function r(e,t){n[e]||(n[e]={});const r=t.Gender.toLowerCase(),o=t.Id||t.VoiceId,i=t.SupportedEngines||(t.Engine?[t.Engine]:[]),s=i.includes("neural")?"neural":i.includes("standard")?"standard":i[0]||"",c=a(s);if("female"===r){const t=n[e].female,r=a(null===t||void 0===t?void 0:t.engine);(!t||c>r)&&(n[e].female={voiceId:o,engine:s})}if("male"===r){const t=n[e].male,r=a(null===t||void 0===t?void 0:t.engine);(!t||c>r)&&(n[e].male={voiceId:o,engine:s})}}for(const[o,i]of Object.entries(e))for(const e of i)if(r(o,e),Array.isArray(e.AdditionalLanguageCodes))for(const n of e.AdditionalLanguageCodes)r(n,e);return n}async fetchVoiceAndEngine(e,n){return{voice:"",engine:""}}async getVoiceIdAndEngine(e,n){return await this.getVoices(e,n)}async getVoices(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=await this.fetchLanguages(),{male:a,female:r}=t[e];return(a||r)&&n?"male"===n&&a?a:"female"===n&&r?r:"male"!==n||a?"female"!==n||r?void 0:a:r:{}}constructor({region:e,credentials:n,languageCode:t,gender:a}){return this.region=e,this.credentials=n,this.languageCode=t,this.gender=a,this.pollyClient=new C.z({region:e,credentials:n}),L.instance||(L.instance=this),L.instance}}new class{on(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(n)}emit(e,n){(this.listeners[e]||[]).forEach((e=>e(n)))}off(e,n){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((e=>e!==n)))}constructor(){this.listeners={}}};let T,k,N={};const R=async e=>{let{sourceLanguage:n,targetLanguage:t,audioHeardAs:r,output:o,onProcessed:i,onError:s,onConnected:c}=e;if(Object.keys(a).includes(n)){return await b({sourceLanguage:n,targetLanguage:t,audioHeardAs:r,output:o,onProcessed:i,onError:s,onConnected:c})}return await B({sourceLanguage:n,targetLanguage:t,audioHeardAs:r,output:o,onProcessed:i,onError:s,onConnected:c})},b=async e=>{let{sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:s,onError:c,onConnected:l}=e;if(!T){const{access_token:e}=await h("stt"),t=o[n]||null;console.log("Model is:::",t),T=new i({token:e,model:t})}await T.start({onTranscription:async e=>{if("transcriptOnly"===r)s({transcript:e.transcript});else if("translateOnly"===r){const{translation:a,translationError:r}=await V({transcript:e.transcript,sourceLanguage:n,targetLanguage:t});r?c&&c(r):s({transcript:e.transcript,translation:a})}else if("audioOnly"===r){const r=await H({transcript:e.transcript,sourceLanguage:n,targetLanguage:t,audioHeardAs:a});s(r)}},onError:e=>{c&&c("[NABU StreamingV1] error:",e)},onComplete:()=>{},onConnected:()=>{l&&l()}})},U=async e=>{let{onPaused:n}=e;if(T&&T instanceof i)return await T.pause({onPaused:n})},_=async e=>{let{onResumed:n}=e;if(T&&T instanceof i)return await T.resume({onResumed:n})},P=async e=>{let{onStopped:n}=e;return T&&T instanceof i?await O({onStopped:n}):k&&k instanceof u?await x({onStopped:n}):void 0},O=async e=>{let{onStopped:n}=e;T&&T instanceof i&&await T.stop({onStreamingStopped:()=>{T=null,n()}})},x=async e=>{let{onStopped:n}=e;k&&k instanceof u&&await k.stop({onStreamingStopped:()=>{k=null,n()}})},B=async e=>{let{sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:o,onError:i,onConnected:s}=e;k=new u({region:N.region,credentials:N.credentials,languageCode:n}),await k.start(null,{onData:async e=>{if("transcriptOnly"===r)o({transcript:e});else if("translateOnly"===r){const{translation:a,translationError:r}=await V({transcript:data.transcript,sourceLanguage:n,targetLanguage:t});r?i&&i(r):o({transcript:e,translation:a})}else if("audioOnly"===r){const r=await H({transcript:e,sourceLanguage:n,targetLanguage:t,audioHeardAs:a});o(r)}},onError:e=>{i&&i("[NABU StreamingV1] error:",e)},onComplete:()=>{},onConnected:()=>{s&&s()}})},V=async e=>{let{transcript:n,sourceLanguage:t,targetLanguage:a}=e;console.log("getTranslationText: ".concat(n));const r=new y({region:N.region,credentials:N.credentials}),{translation:o,translationError:i}=await r.translateText(n,t,a);return{translation:o,translationError:i}},H=async e=>{let{transcript:n,sourceLanguage:t,targetLanguage:r,audioHeardAs:o,onTranslated:i,onProcessed:s,onError:c}=e;return console.log("Generating translation for text: ".concat(n)),Object.keys(a).includes(r)?await M({transcript:n,sourceLanguage:t,targetLanguage:r,audioHeardAs:o,onTranslated:i,onProcessed:s,onError:c}):await D({transcript:n,sourceLanguage:t,targetLanguage:r,audioHeardAs:o,onTranslated:i,onProcessed:s,onError:c})},M=async e=>{let{transcript:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:o,onProcessed:i,onError:s}=e;const{translation:c,translationError:l}=await V({transcript:n,sourceLanguage:t,targetLanguage:a});l&&s&&s({message:l}),o&&o({translation:c,translationError:l});const{audio:d,message:u}=await W({text:c,targetLanguage:a,audioHeardAs:r});i&&d&&i({translation:c,audio:d,message:u})},D=async e=>{let{transcript:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:o,onProcessed:i,onError:s}=e;const{translation:c,translationError:l}=await V({transcript:n,sourceLanguage:t,targetLanguage:a});l&&s&&s({message:l}),o&&o({translation:c,translationError:l});const d=await G({text:c,targetLanguage:a,audioHeardAs:r});i&&d&&i({translation:c,audio:d})},G=async e=>{let{text:n,targetLanguage:t,audioHeardAs:a}=e;const r=new L({region:N.region,credentials:N.credentials,languageCode:t,gender:a}),{voiceId:o,engine:i}=await r.getVoiceIdAndEngine(t,a),s=await r.audioText(n,o,i,t,"mp3");return new Blob([await s.transformToByteArray()],{type:"audio/mpeg"})},W=async e=>{let{text:n,targetLanguage:t,audioHeardAs:a}=e;const{access_token:r}=await h("tts"),o=new I({sttAccessToken:r,languageCode:t}),i={gender:a,languageCode:t,accessToken:r,text:n},{audio:s,message:c}=await o.generateSpeech(i);return{audio:s,message:c}};const K=t(9079).env.npm_package_version,J=r,F=async e=>{let{sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:o,onError:i,onConnected:s}=e;const c=await(async e=>{let{sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:o,onError:i,onConnected:s}=e;if(!(null===N||void 0===N?void 0:N.region)){const e=await f();N={region:e.region,credentials:{accessKeyId:e.apiKey,secretAccessKey:e.secretKey}}}return await R({sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:o,onError:i,onConnected:s})})({sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:o,onError:i,onConnected:s});return c},j=async e=>{let{text:n,sourceLanguage:t,targetLanguage:a,onProcessed:r,onError:o}=e;const i=await(async e=>{let{text:n,sourceLanguage:t,targetLanguage:a,onProcessed:r,onError:o}=e;if(!(null===N||void 0===N?void 0:N.region)){const e=await f();N={region:e.region,credentials:{accessKeyId:e.apiKey,secretAccessKey:e.secretKey}}}const{translation:i,translationError:s}=await V({transcript:n,sourceLanguage:t,targetLanguage:a});s?o&&o(s):r({translation:i})})({text:n,sourceLanguage:t,targetLanguage:a,onProcessed:r,onError:o});return i},z=async e=>{let{text:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:o,onProcessed:i,onError:s}=e;const c=await(async e=>{let{text:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:o,onProcessed:i,onError:s}=e;if(!(null===N||void 0===N?void 0:N.region)){const e=await f();N={region:e.region,credentials:{accessKeyId:e.apiKey,secretAccessKey:e.secretKey}}}return await H({transcript:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:o,onProcessed:i,onError:s})})({text:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:o,onProcessed:i,onError:s});return c},Z=async e=>{let{onStopped:n}=e;return await(async e=>{let{onStopped:n}=e;return await P({onStopped:n})})({onStopped:n})},Q=async e=>await(async e=>{if(console.log("[NABU] Stream Initialization::::",e),Object.keys(a).includes(e)){const{access_token:e}=await h("stt");T=new i({token:e}),T.initializeWS(e)}})(e),X=async e=>{let{onPaused:n}=e;return await(async e=>{let{onPaused:n}=e;return await U({onPaused:n})})({onPaused:n})},q=async e=>{let{onResumed:n}=e;return await(async e=>{let{onResumed:n}=e;return await _({onResumed:n})})({onResumed:n})}},8504:function(e,n,t){t.d(n,{J:function(){return a}});const a="https://nabu-0390bfe7dc2f.herokuapp.com"},4289:function(e,n,t){t.d(n,{Ie:function(){return S},SQ:function(){return u},SS:function(){return f},aT:function(){return p},bE:function(){return g},e$:function(){return h},vP:function(){return m},wQ:function(){return v},yt:function(){return d}});var a=t(4095),r=t(8504);let o=null;const i=new Set,s=new Set,c=new Set,l=new Set;function d(e,n){return o||(o=new WebSocket("".concat(r.J,"?room=").concat(e,"&uid=").concat(n)),o.onopen=()=>{console.log("[NABU WS] Connected to room ".concat(e)),setInterval((()=>{o&&o.readyState===WebSocket.OPEN&&o.send("keep-alive")}),3e4)},o.onerror=t=>{console.error("[NABU WS] WebSocket error",t),o.close(),o=null,console.error("[NABU WS] WebSocket Reconnecting",t),o=new WebSocket("".concat(r.J,"?room=").concat(e,"&uid=").concat(n))},o.onclose=()=>{console.warn("[NABU WS] Disconnected"),o=null},o.onmessage=e=>{try{const n=JSON.parse(e.data);if("hand"===n.type)i.forEach((e=>e(n.uid,n.raised)));else if("chat"===n.type)s.forEach((e=>e(n.uid,n.text,n.sourceLanguage)));else if("mute"===n.type)c.forEach((e=>e(n.uid,n.muted)));else if("transcript"===n.type){a.E.getState().setActiveSpeaker(n.uid),l.forEach((e=>e(n.uid,n.transcript,n.sourceLanguage,n.audioHeardAs)))}else if("room-state"===n.type){const{raisedHands:e,mutedUsers:t}=n,r=a.E.getState();Object.entries(e||{}).forEach((e=>{let[n,t]=e;r.setHandState(n,t)})),Object.entries(t||{}).forEach((e=>{let[n,t]=e;r.setMuteState(n,t)}))}}catch(n){console.warn("[NABU WS] Invalid message",e.data)}},o)}function u(e,n){o&&o.readyState===WebSocket.OPEN&&o.send(JSON.stringify({type:"hand",uid:e,raised:n}))}function g(e,n,t){o&&o.readyState===WebSocket.OPEN&&o.send(JSON.stringify({type:"chat",uid:e,text:n,sourceLanguage:t}))}function m(e,n){o&&o.readyState===WebSocket.OPEN&&(console.log("[NABU] Sending Mute for user, ".concat(e," with state: ").concat(n)),o.send(JSON.stringify({type:"mute",uid:e,muted:n})))}function p(e,n,t,a){o&&o.readyState===WebSocket.OPEN&&o.send(JSON.stringify({type:"transcript",uid:e,transcript:n,sourceLanguage:t,audioHeardAs:a}))}function h(e){return i.add(e),()=>{i.delete(e)}}function f(e){return s.add(e),()=>{s.delete(e)}}function S(e){return c.add(e),()=>{c.delete(e)}}function v(e){return l.add(e),()=>{l.delete(e)}}},4095:function(e,n,t){t.d(n,{E:function(){return a}});const a=(0,t(2574).U)((e=>({muted:!0,videoEnabled:!1,raisedHands:{},mutedUsers:{},activeSpeakerUid:null,toggleMute:()=>e((e=>({muted:!e.muted}))),toggleVideo:()=>e((e=>({videoEnabled:!e.videoEnabled}))),raiseHand:n=>e((e=>{var t;const a=null!==(t=e.raisedHands[n])&&void 0!==t&&t;return{raisedHands:{...e.raisedHands,[n]:!a}}})),muteUser:n=>e((e=>{var t;const a=null!==(t=e.mutedUsers[n])&&void 0!==t&&t;return{mutedUsers:{...e.mutedUsers,[n]:!a}}})),setActiveSpeaker:n=>e((()=>({activeSpeakerUid:n}))),agoraInstance:null,agoraClient:null,setAgoraInstance:n=>e((()=>({agoraInstance:n}))),setAgoraClient:n=>e((()=>({agoraInstance:n}))),isChatOpen:!1,isTranscriptOpen:!1,isParticipantsOpen:!1,toggleChat:()=>e((e=>({isChatOpen:!e.isChatOpen,isParticipantsOpen:!1,isTranscriptOpen:!1}))),toggleTranscript:()=>e((e=>({isTranscriptOpen:!e.isTranscriptOpen,isParticipantsOpen:!1,isChatOpen:!1}))),toggleParticipants:()=>e((e=>({isParticipantsOpen:!e.isParticipantsOpen,isChatOpen:!1,isTranscriptOpen:!1}))),messages:[],addMessage:(n,t,a)=>e((e=>({messages:[...e.messages,{uid:n,text:t,sourceLanguage:a,time:(new Date).toLocaleTimeString()}]}))),transcripts:[],addTranscript:(n,t,a,r)=>e((e=>({transcripts:[...e.transcripts,{uid:n,transcript:t,sourceLanguage:a,audioHeardAs:r,time:(new Date).toLocaleTimeString()}]}))),meetingInfo:{},setMeetingInfo:n=>e((()=>({meetingInfo:n}))),setHandState:(n,t)=>e((e=>({raisedHands:t?{...e.raisedHands,[n]:!0}:Object.fromEntries(Object.entries(e.raisedHands).filter((e=>{let[t]=e;return t!==n})))}))),setMuteState:(n,t)=>e((e=>({mutedUsers:t?{...e.mutedUsers,[n]:!0}:Object.fromEntries(Object.entries(e.mutedUsers).filter((e=>{let[t]=e;return t!==n})))})))})))}}]);