"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[878],{3753:function(e,n,a){a.r(n),a.d(n,{generateTranslationAudio:function(){return z},pauseMicrophoneRecording:function(){return X},prepareStreaming:function(){return Q},processMicrophone:function(){return j},resumeMicrophoneRecording:function(){return q},stopMicrophoneRecording:function(){return Z},supportedLanguages:function(){return J},translate:function(){return W},version:function(){return F}});const t={"en-AU":"English (Australian)","en-GB":"English (British)","en-NZ":"English (New Zealand)","en-US":"English (US)","fr-FR":"French","fr-CA":"French (Canadian)","de-DE":"German","it-IT":"Italian","ja-JP":"Japanese","ko-KR":"Korean","pt-BR":"Portuguese (Brazilian)","es-ES":"Spanish (European)","es-US":"Spanish (US)"},r={...t,arb:"Arabic","ar-AE":"Arabic (Gulf)","ca-ES":"Catalan","yue-CN":"Chinese (Cantonese)","cmn-CN":"Chinese (Mandarin)","cs-CZ":"Czech","da-DK":"Danish","nl-BE":"Dutch (Belgian)","nl-NL":"Dutch","en-AU":"English (Australian)","en-GB":"English (British)","en-IN":"English (Indian)","en-NZ":"English (New Zealand)","en-SG":"English (Singaporean)","en-ZA":"English (South African)","en-US":"English (US)","en-GB-WLS":"English (Welsh)","fi-FI":"Finnish","fr-FR":"French","fr-BE":"French (Belgian)","fr-CA":"French (Canadian)","hi-IN":"Hindi","de-DE":"German","de-AT":"German (Austrian)","de-CH":"German (Swiss standard)","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","ko-KR":"Korean","nb-NO":"Norwegian","pl-PL":"Polish","pt-BR":"Portuguese (Brazilian)","pt-PT":"Portuguese (European)","ro-RO":"Romanian","ru-RU":"Russian","es-ES":"Spanish (Spain)","es-MX":"Spanish (Mexican)","es-US":"Spanish (US)","sv-SE":"Swedish","tr-TR":"Turkish","cy-GB":"Welsh"},i={"en-US":"en-US_BroadbandModel","en-GB":"en-GB_BroadbandModel","en-AU":"en-AU_BroadbandModel","en-NZ":"en-NZ_BroadbandModel","es-ES":"es-ES_BroadbandModel","es-LA":"es-LA_BroadbandModel","es-US":"es-US_BroadbandModel","fr-FR":"fr-FR_BroadbandModel","fr-CA":"fr-CA_BroadbandModel","de-DE":"de-DE_BroadbandModel","it-IT":"it-IT_BroadbandModel","pt-BR":"pt-BR_BroadbandModel","ja-JP":"ja-JP_BroadbandModel","nl-NL":"nl-NL_BroadbandModel","ko-KR":"ko-KR_BroadbandModel","zh-CN":"zh-CN_BroadbandModel"};class s{on(e,n){this.listeners[e]=this.listeners[e]||[],this.listeners[e].push(n)}emit(e,n){if(this.listeners[e])for(const a of this.listeners[e])a(n)}setToken(e){this.token=e}async start(e){let{onTranscription:n,onError:a,onComplete:t}=e;const r=this.buildWebSocketUrl(this.token);this.ws=await new WebSocket(r),this.startMic(),this.ws.onopen=()=>{console.log("[StreamingV1] connected"),this.sendStartMessage()},this.ws.onmessage=e=>{const a=JSON.parse(e.data);if(a.results&&a.results.length>0&&a.results[0].final){const e=a.results[0].alternatives[0];n({transcript:e.transcript,timestamps:e.timestamps,confidence:e.confidence,labels:a.speaker_labels})}},this.ws.onerror=e=>{a(e),console.error("[StreamingV1] error:",e)},this.ws.onclose=()=>{t(),console.log("[StreamingV1] closed")}}stop(e){let{onStreamingStopped:n}=e;this.mediaRecorder&&"inactive"!==this.mediaRecorder.state&&this.mediaRecorder.stop(),this.audioChunks=[],this.haveSentStartMessage=!1,this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.ws.send(JSON.stringify({action:"stop"})),this.ws.close(),this.ws=null),this.stream&&this.stream.getTracks().forEach((e=>e.stop())),n&&n()}async fetchToken(){const e=await fetch(this.tokenUrl);if(!e.ok)throw new Error("Failed to get token");return(await e.json()).access_token}buildWebSocketUrl(e){const n=new URLSearchParams({access_token:e,model:this.model,inactivity_timeout:-1});return"".concat("wss://api.us-east.speech-to-text.watson.cloud.ibm.com/instances/866db787-0272-4cdd-9ebe-110e2db04346/v1/recognize","?").concat(n.toString())}sendStartMessage(){this.ws.send(JSON.stringify({action:"start","content-type":"audio/webm;codecs=opus",interim_results:!0,timestamps:!0,speaker_labels:!0})),this.audioChunks.length>0&&this.ws.send(new Blob(this.audioChunks,{type:"audio/webm;codecs=opus"})),this.haveSentStartMessage=!0,this.audioChunks=[]}async startMic(){this.stream=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:16e3}),this.mediaRecorder.ondataavailable=e=>{e.data.size>100&&(this.ws&&this.ws.readyState===WebSocket.OPEN&&this.haveSentStartMessage?this.ws.send(e.data):this.audioChunks.push(e.data))},this.mediaRecorder.onstop=()=>{console.log("[StreamingV1] Recording stopped")},this.mediaRecorder.start(250)}constructor({token:e,model:n="en-US_BroadbandModel"}){this.token=e,this.model=n,this.ws=null,this.mediaRecorder=null,this.stream=null,this.listeners={},this.audioChunks=[],this.timeout=null,this.haveSentStartMessage=!1}}var o=a(4223),c=a(5796),d=a(3856),l=a.n(d);class u{async start(e,n){let{onData:a,onError:t,onComplete:r}=n;if(window&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),e){const n=await e.arrayBuffer();this.bufferStream=n;const a=await this.audioContext.decodeAudioData(n),t=a.duration;console.log("Duration::::",t),this.bufferSource=this.audioContext.createBufferSource(),this.bufferSource.buffer=a}else this.audioStreams=await navigator.mediaDevices.getUserMedia({audio:!0}),this.audioSource=this.audioContext.createMediaStreamSource(this.audioStreams);const i={numberOfChannels:1,sampleRate:this.audioContext.sampleRate,maxFrameCount:1*this.audioContext.sampleRate/10};try{await this.audioContext.audioWorklet.addModule("./recording-processor.js"),console.log("connected")}catch(m){console.log("Add module error ".concat(m))}if(this.workletNode=new AudioWorkletNode(this.audioContext,"recording-processor",{processorOptions:i}),this.workletNode.port.postMessage({message:"UPDATE_RECORDING_STATE",setRecording:!0}),e)this.bufferSource.connect(this.workletNode).connect(this.audioContext.destination),this.bufferSource.start(),console.log("starting file");else{const e=this.audioContext.createMediaStreamDestination();this.audioSource.connect(this.workletNode).connect(e)}this.workletNode.port.onmessageerror=e=>{console.log("Error receiving message from worklet ".concat(e)),t&&t(e)};const s=l().iterator(this.workletNode.port,"message"),c=e=>{const n=new ArrayBuffer(2*e.length),a=new DataView(n);for(let t=0;t<e.length;t++){const n=Math.max(-1,Math.min(1,e[t]));a.setInt16(2*t,n<0?32768*n:32767*n,!0)}return n};this.command=new o.W({LanguageCode:this.languageCode,MediaEncoding:"pcm",MediaSampleRateHertz:"48000",AudioStream:async function*(){for await(const e of s)if("SHARE_RECORDING_BUFFER"===e.data.message){const n=c(e.data.buffer[0]),a=new Uint8Array(n);yield{AudioEvent:{AudioChunk:a}}}}()});try{const e=await this.streamingClient.send(this.command);if(e.TranscriptResultStream){for await(const n of e.TranscriptResultStream){var d,u;if(null===n||void 0===n||null===(d=n.TranscriptEvent)||void 0===d?void 0:d.Transcript)for(const e of(null===n||void 0===n||null===(u=n.TranscriptEvent)||void 0===u?void 0:u.Transcript.Results)||[])if((null===e||void 0===e?void 0:e.Alternatives)&&(null===e||void 0===e?void 0:e.Alternatives[0].Items)){var g;let n="";for(let a=0;a<(null===e||void 0===e||null===(g=e.Alternatives[0].Items)||void 0===g?void 0:g.length);a++)n+=" ".concat(null===e||void 0===e?void 0:e.Alternatives[0].Items[a].Content);e.IsPartial||(n.endsWith(" .")&&(n=n.replace(" .",".")),n&&a&&a(n))}}r&&r()}}catch(h){t&&t(h)}}async stop(e){let{onStreamingStopped:n}=e;var a;(this.workletNode&&this.workletNode.port.postMessage({message:"UPDATE_RECORDING_STATE",setRecording:!1}),this.audioSource&&this.audioSource.disconnect(this.workletNode),this.bufferSource&&this.bufferSource.disconnect(this.workletNode),this.workletNode&&this.workletNode.disconnect(),this.streamingClient.destroy(),this.audioStreams)&&(null===(a=this.audioStreams.getTracks())||void 0===a||a.forEach((e=>e.stop())),this.audioStreams=null);this.audioContext&&(await this.audioContext.close(),this.audioContext=null),n&&n()}constructor({region:e,credentials:n,languageCode:a="en-US",sampleRate:t=44100}){this.region=e,this.credentials=n,this.languageCode=a,this.sampleRate=t,this.audioContext=null,this.workletNode=null,this.streamingClient=new c.I({region:e,credentials:n}),this.controller=null,this.audioStreams=null,this.bufferStream=null,this.audioSource=null,this.bufferSource=null}}var g=a(7563),m=a.n(g);const h="https://nabu-0390bfe7dc2f.herokuapp.com",f=async e=>{const n="".concat(h,"/get-token?serviceName=").concat(e);try{return(await m().get(n)).data}catch(a){return console.error("Error fetching access token:",a),null}},p=async()=>{const e="".concat(h,"/get-creds");try{return(await m().get(e)).data}catch(n){return console.error("Error fetching creds:",n),null}};var S=a(7272),v=a(4563);class w{async translateText(e,n,a){try{const t=new S.r({Text:e,SourceLanguageCode:n,TargetLanguageCode:a});return{translation:(await this.translateClient.send(t)).TranslatedText}}catch(t){return{translationError:t}}}constructor({region:e,credentials:n}){this.region=e,this.credentials=n,this.translateClient=new v.O({region:e,credentials:n})}}var E=a(2781),y=a.n(E);class I{async generateSpeech(e){const n=this.getIBMVoiceFromLanguageCode(e.languageCode,e.gender);if(e.voice=n,e.accessToken||(e.accessToken=this.ttsAccessToken),e.autoPlay=!1,!e.text)return{message:"Please input the 'text' param"};if(!e.accessToken)return{message:"Please input 'accessToken' param"};if(!n)return{message:"No voice found for the language code: ".concat(e.languageCode)};try{var a=e.url||"https://api.au-syd.text-to-speech.watson.cloud.ibm.com",t=this.processUserParams(e,["voice","X-Watson-Learning-Opt-Out","text","watson-token","access_token","accept","customization_id"]);const n=await fetch(a+"/v1/synthesize?"+this.stringify(t),{method:"GET"}),r=await n.blob();return r?{audio:r}:{message:"Failed to generate audio"}}catch(r){return{message:r}}}processUserParams(e,n){var a={};return n.forEach((n=>{var t=y()(n);void 0!==e[t]&&(a[n]=e[t])})),a}stringify(e){return Object.keys(e).map((function(n){return n+"="+encodeURIComponent(e[n])})).join("&")}getModelFromLanguageCode(e){return{"de-DE":"de-DE_Multimedia","en-US":"en-US_Multimedia","en-GB":"en-GB_Multimedia","en-AU":"en-AU_Multimedia","es-ES":"es-ES_Multimedia","fr-CA":"fr-CA_Multimedia","fr-FR":"fr-FR_Multimedia","it-IT":"it-IT_Multimedia","ja-JP":"ja-JP_Multimedia","ko-KR":"ko-KR_Multimedia","nl-NL":"nl-NL_Multimedia","pt-BR":"pt-BR_Multimedia"}[e]}getIBMVoiceFromLanguageCode(e,n){const a={"en-US":{male:"en-US_HenryV3Voice",female:"en-US_AllisonV3Voice"},"en-GB":{male:"en-GB_JamesV3Voice",female:"en-GB_KateV3Voice"},"en-AU":{male:"en-AU_JackExpressive",female:"en-AU_HeidiExpressive"},"es-ES":{male:"es-ES_EnriqueV3Voice",female:"es-ES_LauraV3Voice"},"es-LA":{female:"es-LA_SofiaV3Voice"},"es-US":{female:"es-US_SofiaV3Voice"},"fr-FR":{male:"fr-FR_NicolasV3Voice",female:"fr-FR_ReneeV3Voice"},"fr-CA":{female:"fr-CA_LouiseV3Voice"},"de-DE":{male:"de-DE_DieterV3Voice",female:"de-DE_BirgitV3Voice"},"it-IT":{female:"it-IT_FrancescaV3Voice"},"pt-BR":{male:"pt-BR_LucasExpressive",female:"pt-BR_IsabelaV3Voice"},"ja-JP":{female:"ja-JP_EmiV3Voice"},"ko-KR":{female:"ko-KR_JinV3Voice"}}[e];if(!a)return null;if(!n)return a;const t=a[n.toLowerCase()];if(t)return t;return a.male||a.female||null}constructor({sttAccessToken:e,ttsAccessToken:n,languageCode:a="en-US"}){return this.sttAccessToken=e,this.ttsAccessToken=n,this.languageCode=a,this.audioStream=null,I.instance||(I.instance=this),I.instance}}var A=a(1806),L=a(1843);class C{async audioText(e,n,a,t){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mp3";const i=new A.Q({OutputFormat:r,Text:e,VoiceId:n,Engine:a,LanguageCode:t}),{AudioStream:s}=await this.pollyClient.send(i);return s}async fetchLanguages(){return{"fr-BE":{female:{voiceId:"Isabelle",engine:"neural"}},"en-US":{female:{voiceId:"Danielle",engine:"neural"},male:{voiceId:"Gregory",engine:"neural"}},"tr-TR":{female:{voiceId:"Burcu",engine:"neural"}},"cs-CZ":{female:{voiceId:"Jitka",engine:"neural"}},"de-CH":{female:{voiceId:"Sabrina",engine:"neural"}},"es-ES":{female:{voiceId:"Lucia",engine:"neural"},male:{voiceId:"Sergio",engine:"neural"}},"es-US":{female:{voiceId:"Lupe",engine:"neural"},male:{voiceId:"Pedro",engine:"neural"}},"en-SG":{female:{voiceId:"Jasmine",engine:"neural"}},"ko-KR":{female:{voiceId:"Jihye",engine:"neural"}},"sv-SE":{female:{voiceId:"Elin",engine:"neural"}},"ru-RU":{female:{voiceId:"Tatyana",engine:"standard"},male:{voiceId:"Maxim",engine:"standard"}},"ro-RO":{female:{voiceId:"Carmen",engine:"standard"}},"pt-PT":{female:{voiceId:"Ines",engine:"neural"},male:{voiceId:"Cristiano",engine:"standard"}},"pt-BR":{female:{voiceId:"Vitoria",engine:"neural"},male:{voiceId:"Thiago",engine:"neural"}},"pl-PL":{female:{voiceId:"Ola",engine:"neural"},male:{voiceId:"Jan",engine:"standard"}},"nl-BE":{female:{voiceId:"Lisa",engine:"neural"}},"nl-NL":{male:{voiceId:"Ruben",engine:"standard"},female:{voiceId:"Laura",engine:"neural"}},"nb-NO":{female:{voiceId:"Ida",engine:"neural"}},"ja-JP":{female:{voiceId:"Kazuha",engine:"neural"},male:{voiceId:"Takumi",engine:"neural"}},"it-IT":{female:{voiceId:"Bianca",engine:"neural"},male:{voiceId:"Adriano",engine:"neural"}},"is-IS":{male:{voiceId:"Karl",engine:"standard"},female:{voiceId:"Dora",engine:"standard"}},"fr-FR":{male:{voiceId:"Remi",engine:"neural"},female:{voiceId:"Lea",engine:"neural"}},"fr-CA":{female:{voiceId:"Gabrielle",engine:"neural"},male:{voiceId:"Liam",engine:"neural"}},"es-MX":{female:{voiceId:"Mia",engine:"neural"},male:{voiceId:"Andres",engine:"neural"}},"en-GB-WLS":{male:{voiceId:"Geraint",engine:"standard"}},"en-NZ":{female:{voiceId:"Aria",engine:"neural"}},"en-ZA":{female:{voiceId:"Ayanda",engine:"neural"}},"en-IN":{female:{voiceId:"Kajal",engine:"neural"}},"hi-IN":{female:{voiceId:"Kajal",engine:"neural"}},"en-GB":{female:{voiceId:"Emma",engine:"neural"},male:{voiceId:"Brian",engine:"neural"}},"en-AU":{male:{voiceId:"Russell",engine:"standard"},female:{voiceId:"Olivia",engine:"neural"}},"de-DE":{female:{voiceId:"Vicki",engine:"neural"},male:{voiceId:"Daniel",engine:"neural"}},"da-DK":{female:{voiceId:"Sofie",engine:"neural"},male:{voiceId:"Mads",engine:"standard"}},"cy-GB":{female:{voiceId:"Gwyneth",engine:"standard"}},"cmn-CN":{female:{voiceId:"Zhiyu",engine:"neural"}},arb:{female:{voiceId:"Hala",engine:"neural"},male:{voiceId:"Zayd",engine:"neural"}},"ar-AE":{female:{voiceId:"Hala",engine:"neural"},male:{voiceId:"Zayd",engine:"neural"}},"ca-ES":{female:{voiceId:"Arlet",engine:"neural"}},"de-AT":{female:{voiceId:"Hannah",engine:"neural"}},"yue-CN":{female:{voiceId:"Hiujin",engine:"neural"}},"fi-FI":{female:{voiceId:"Suvi",engine:"neural"}},"en-IE":{female:{voiceId:"Niamh",engine:"neural"}}}}formatVoices(e){const n={},a={neural:3,standard:2,generative:1};function t(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return a[e.toLowerCase()]||0}function r(e,a){n[e]||(n[e]={});const r=a.Gender.toLowerCase(),i=a.Id||a.VoiceId,s=a.SupportedEngines||(a.Engine?[a.Engine]:[]),o=s.includes("neural")?"neural":s.includes("standard")?"standard":s[0]||"",c=t(o);if("female"===r){const a=n[e].female,r=t(null===a||void 0===a?void 0:a.engine);(!a||c>r)&&(n[e].female={voiceId:i,engine:o})}if("male"===r){const a=n[e].male,r=t(null===a||void 0===a?void 0:a.engine);(!a||c>r)&&(n[e].male={voiceId:i,engine:o})}}for(const[i,s]of Object.entries(e))for(const e of s)if(r(i,e),Array.isArray(e.AdditionalLanguageCodes))for(const n of e.AdditionalLanguageCodes)r(n,e);return n}async fetchVoiceAndEngine(e,n){return{voice:"",engine:""}}async getVoiceIdAndEngine(e,n){return await this.getVoices(e,n)}async getVoices(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const a=await this.fetchLanguages(),{male:t,female:r}=a[e];return(t||r)&&n?"male"===n&&t?t:"female"===n&&r?r:"male"!==n||t?"female"!==n||r?void 0:t:r:{}}constructor({region:e,credentials:n,languageCode:a,gender:t}){return this.region=e,this.credentials=n,this.languageCode=a,this.gender=t,this.pollyClient=new L.z({region:e,credentials:n}),C.instance||(C.instance=this),C.instance}}new class{on(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(n)}emit(e,n){(this.listeners[e]||[]).forEach((e=>e(n)))}off(e,n){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((e=>e!==n)))}constructor(){this.listeners={}}};let k,b,T={};const R=async e=>{let{sourceLanguage:n,targetLanguage:a,audioHeardAs:r,output:i,onProcessed:s,onError:o}=e;if(Object.keys(t).includes(n)){return await B({sourceLanguage:n,targetLanguage:a,audioHeardAs:r,output:i,onProcessed:s,onError:o})}return await O({sourceLanguage:n,targetLanguage:a,audioHeardAs:r,output:i,onProcessed:s,onError:o})},B=async e=>{let{sourceLanguage:n,targetLanguage:a,audioHeardAs:t,output:r,onProcessed:o,onError:c}=e;if(console.log("Lang in streamingV1:::",n),!k){const{access_token:e}=await f("stt");k=new s({token:e,model:i[n]||null})}await k.start({onTranscription:async e=>{if("transcriptOnly"===r)o({transcript:e.transcript});else if("translateOnly"===r){const{translation:t,translationError:r}=await V({transcript:e.transcript,sourceLanguage:n,targetLanguage:a});r?c&&c(r):o({transcript:e.transcript,translation:t})}else if("audioOnly"===r){const r=await x({transcript:e.transcript,sourceLanguage:n,targetLanguage:a,audioHeardAs:t});o(r)}},onError:e=>{c&&c("[NABU StreamingV1] error:",e)},onComplete:()=>{}})},_=async e=>{let{onPaused:n}=e;if(k&&k instanceof s)return await k.pause({onPaused:n})},N=async e=>{let{onResumed:n}=e;if(k&&k instanceof s)return await k.resume({onResumed:n})},M=async e=>{let{onStopped:n}=e;return k&&k instanceof s?await P({onStopped:n}):b&&b instanceof u?await U({onStopped:n}):void 0},P=async e=>{let{onStopped:n}=e;k&&k instanceof s&&await k.stop({onStreamingStopped:()=>{k=null,n()}})},U=async e=>{let{onStopped:n}=e;b&&b instanceof u&&await b.stop({onStreamingStopped:()=>{b=null,n()}})},O=async e=>{let{sourceLanguage:n,targetLanguage:a,audioHeardAs:t,output:r,onProcessed:i,onError:s}=e;b=new u({region:T.region,credentials:T.credentials,languageCode:n}),await b.start(null,{onData:async e=>{if("transcriptOnly"===r)i({transcript:e});else if("translateOnly"===r){const{translation:t,translationError:r}=await V({transcript:data.transcript,sourceLanguage:n,targetLanguage:a});r?s&&s(r):i({transcript:e,translation:t})}else if("audioOnly"===r){const r=await x({transcript:e,sourceLanguage:n,targetLanguage:a,audioHeardAs:t});i(r)}},onError:e=>{s&&s("[NABU StreamingV1] error:",e)},onComplete:()=>{}})},V=async e=>{let{transcript:n,sourceLanguage:a,targetLanguage:t}=e;console.log("getTranslationText: ".concat(n));const r=new w({region:T.region,credentials:T.credentials}),{translation:i,translationError:s}=await r.translateText(n,a,t);return{translation:i,translationError:s}},x=async e=>{let{transcript:n,sourceLanguage:a,targetLanguage:r,audioHeardAs:i,onTranslated:s,onProcessed:o,onError:c}=e;return console.log("Generating translation for text: ".concat(n)),Object.keys(t).includes(r)?await H({transcript:n,sourceLanguage:a,targetLanguage:r,audioHeardAs:i,onTranslated:s,onProcessed:o,onError:c}):await D({transcript:n,sourceLanguage:a,targetLanguage:r,audioHeardAs:i,onTranslated:s,onProcessed:o,onError:c})},H=async e=>{let{transcript:n,sourceLanguage:a,targetLanguage:t,audioHeardAs:r,onTranslated:i,onProcessed:s,onError:o}=e;const{translation:c,translationError:d}=await V({transcript:n,sourceLanguage:a,targetLanguage:t});d&&o&&o({message:d}),i&&i({translation:c,translationError:d});const{audio:l,message:u}=await K({text:c,targetLanguage:t,audioHeardAs:r});s&&l&&s({translation:c,audio:l,message:u})},D=async e=>{let{transcript:n,sourceLanguage:a,targetLanguage:t,audioHeardAs:r,onTranslated:i,onProcessed:s,onError:o}=e;const{translation:c,translationError:d}=await V({transcript:n,sourceLanguage:a,targetLanguage:t});d&&o&&o({message:d}),i&&i({translation:c,translationError:d});const l=await G({text:c,targetLanguage:t,audioHeardAs:r});s&&l&&s({translation:c,audio:l})},G=async e=>{let{text:n,targetLanguage:a,audioHeardAs:t}=e;const r=new C({region:T.region,credentials:T.credentials,languageCode:a,gender:t}),{voiceId:i,engine:s}=await r.getVoiceIdAndEngine(a,t),o=await r.audioText(n,i,s,a,"mp3");return new Blob([await o.transformToByteArray()],{type:"audio/mpeg"})},K=async e=>{let{text:n,targetLanguage:a,audioHeardAs:t}=e;const{access_token:r}=await f("tts"),i=new I({sttAccessToken:r,languageCode:a}),s={gender:t,languageCode:a,accessToken:ttsToken,text:n},{audio:o,message:c}=await i.generateSpeech(s);return{audio:o,message:c}};const F=a(9079).env.npm_package_version,J=r,j=async e=>{let{sourceLanguage:n,targetLanguage:a,audioHeardAs:t,output:r,onProcessed:i,onError:s}=e;const o=await(async e=>{let{sourceLanguage:n,targetLanguage:a,audioHeardAs:t,output:r,onProcessed:i,onError:s}=e;if(!(null===T||void 0===T?void 0:T.region)){const e=await p();T={region:e.region,credentials:{accessKeyId:e.apiKey,secretAccessKey:e.secretKey}}}return await R({sourceLanguage:n,targetLanguage:a,audioHeardAs:t,output:r,onProcessed:i,onError:s})})({sourceLanguage:n,targetLanguage:a,audioHeardAs:t,output:r,onProcessed:i,onError:s});return o},W=async e=>{let{text:n,sourceLanguage:a,targetLanguage:t,onProcessed:r,onError:i}=e;const s=await(async e=>{let{text:n,sourceLanguage:a,targetLanguage:t,onProcessed:r,onError:i}=e;if(!(null===T||void 0===T?void 0:T.region)){const e=await p();T={region:e.region,credentials:{accessKeyId:e.apiKey,secretAccessKey:e.secretKey}}}const{translation:s,translationError:o}=await V({transcript:n,sourceLanguage:a,targetLanguage:t});o?i&&i(o):r({translation:s})})({text:n,sourceLanguage:a,targetLanguage:t,onProcessed:r,onError:i});return s},z=async e=>{let{text:n,sourceLanguage:a,targetLanguage:t,audioHeardAs:r,onTranslated:i,onProcessed:s,onError:o}=e;const c=await(async e=>{let{text:n,sourceLanguage:a,targetLanguage:t,audioHeardAs:r,onTranslated:i,onProcessed:s,onError:o}=e;if(!(null===T||void 0===T?void 0:T.region)){const e=await p();T={region:e.region,credentials:{accessKeyId:e.apiKey,secretAccessKey:e.secretKey}}}return await x({transcript:n,sourceLanguage:a,targetLanguage:t,audioHeardAs:r,onTranslated:i,onProcessed:s,onError:o})})({text:n,sourceLanguage:a,targetLanguage:t,audioHeardAs:r,onTranslated:i,onProcessed:s,onError:o});return c},Z=async e=>{let{onStopped:n}=e;return await(async e=>{let{onStopped:n}=e;return await M({onStopped:n})})({onStopped:n})},Q=async e=>await(async e=>{if(console.log("[NABU] Stream Initialization::::",e),Object.keys(t).includes(e)){const{access_token:e}=await f("stt");k=new s({token:e}),k.initializeWS(e)}})(e),X=async e=>{let{onPaused:n}=e;return await(async e=>{let{onPaused:n}=e;return await _({onPaused:n})})({onPaused:n})},q=async e=>{let{onResumed:n}=e;return await(async e=>{let{onResumed:n}=e;return await N({onResumed:n})})({onResumed:n})}},8504:function(e,n,a){a.d(n,{J:function(){return t}});const t="https://nabu-0390bfe7dc2f.herokuapp.com"},4289:function(e,n,a){a.d(n,{Ie:function(){return S},SQ:function(){return u},SS:function(){return p},aT:function(){return h},bE:function(){return g},e$:function(){return f},vP:function(){return m},wQ:function(){return v},yt:function(){return l}});var t=a(4095),r=a(8504);let i=null;const s=new Set,o=new Set,c=new Set,d=new Set;function l(e,n){return i||(i=new WebSocket("".concat(r.J,"?room=").concat(e,"&uid=").concat(n)),i.onopen=()=>{console.log("[NABU WS] Connected to room ".concat(e))},i.onerror=e=>{console.error("[NABU WS] WebSocket error",e)},i.onclose=()=>{console.warn("[NABU WS] Disconnected"),i=null},i.onmessage=e=>{try{const n=JSON.parse(e.data);if("hand"===n.type)s.forEach((e=>e(n.uid,n.raised)));else if("chat"===n.type)o.forEach((e=>e(n.uid,n.text,n.sourceLanguage)));else if("mute"===n.type)c.forEach((e=>e(n.uid,n.muted)));else if("transcript"===n.type){t.E.getState().setActiveSpeaker(n.uid),d.forEach((e=>e(n.uid,n.transcript,n.sourceLanguage,n.audioHeardAs)))}else if("room-state"===n.type){const{raisedHands:e,mutedUsers:a}=n,r=t.E.getState();Object.entries(e||{}).forEach((e=>{let[n,a]=e;r.setHandState(n,a)})),Object.entries(a||{}).forEach((e=>{let[n,a]=e;r.setMuteState(n,a)}))}}catch(n){console.warn("[NABU WS] Invalid message",e.data)}},i)}function u(e,n){i&&i.readyState===WebSocket.OPEN&&i.send(JSON.stringify({type:"hand",uid:e,raised:n}))}function g(e,n,a){i&&i.readyState===WebSocket.OPEN&&i.send(JSON.stringify({type:"chat",uid:e,text:n,sourceLanguage:a}))}function m(e,n){i&&i.readyState===WebSocket.OPEN&&i.send(JSON.stringify({type:"mute",uid:e,muted:n}))}function h(e,n,a,t){i&&i.readyState===WebSocket.OPEN&&i.send(JSON.stringify({type:"transcript",uid:e,transcript:n,sourceLanguage:a,audioHeardAs:t}))}function f(e){return s.add(e),()=>{s.delete(e)}}function p(e){return o.add(e),()=>{o.delete(e)}}function S(e){return c.add(e),()=>{c.delete(e)}}function v(e){return d.add(e),()=>{d.delete(e)}}},4095:function(e,n,a){a.d(n,{E:function(){return t}});const t=(0,a(2574).U)((e=>({muted:!0,videoEnabled:!1,raisedHands:{},mutedUsers:{},activeSpeakerUid:null,toggleMute:()=>e((e=>({muted:!e.muted}))),toggleVideo:()=>e((e=>({videoEnabled:!e.videoEnabled}))),raiseHand:n=>e((e=>{var a;const t=null!==(a=e.raisedHands[n])&&void 0!==a&&a;return{raisedHands:{...e.raisedHands,[n]:!t}}})),muteUser:n=>e((e=>{var a;const t=null!==(a=e.mutedUsers[n])&&void 0!==a&&a;return{mutedUsers:{...e.mutedUsers,[n]:!t}}})),setActiveSpeaker:n=>e((()=>({activeSpeakerUid:n}))),agoraInstance:null,agoraClient:null,setAgoraInstance:n=>e((()=>({agoraInstance:n}))),setAgoraClient:n=>e((()=>({agoraInstance:n}))),isChatOpen:!1,isTranscriptOpen:!1,isParticipantsOpen:!1,toggleChat:()=>e((e=>({isChatOpen:!e.isChatOpen,isParticipantsOpen:!1,isTranscriptOpen:!1}))),toggleTranscript:()=>e((e=>({isTranscriptOpen:!e.isTranscriptOpen,isParticipantsOpen:!1,isChatOpen:!1}))),toggleParticipants:()=>e((e=>({isParticipantsOpen:!e.isParticipantsOpen,isChatOpen:!1,isTranscriptOpen:!1}))),messages:[],addMessage:(n,a,t)=>e((e=>({messages:[...e.messages,{uid:n,text:a,sourceLanguage:t,time:(new Date).toLocaleTimeString()}]}))),transcripts:[],addTranscript:(n,a,t,r)=>e((e=>({transcripts:[...e.transcripts,{uid:n,transcript:a,sourceLanguage:t,audioHeardAs:r,time:(new Date).toLocaleTimeString()}]}))),meetingInfo:{},setMeetingInfo:n=>e((()=>({meetingInfo:n}))),setHandState:(n,a)=>e((e=>({raisedHands:a?{...e.raisedHands,[n]:!0}:Object.fromEntries(Object.entries(e.raisedHands).filter((e=>{let[a]=e;return a!==n})))}))),setMuteState:(n,a)=>e((e=>({mutedUsers:a?{...e.mutedUsers,[n]:!0}:Object.fromEntries(Object.entries(e.mutedUsers).filter((e=>{let[a]=e;return a!==n})))})))})))}}]);