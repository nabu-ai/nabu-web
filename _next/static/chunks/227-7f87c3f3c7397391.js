"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[227],{7989:function(e,n,t){t.r(n),t.d(n,{generateTranslationAudio:function(){return G},pauseMicrophoneRecording:function(){return _},prepareStreaming:function(){return J},processMicrophone:function(){return W},resumeMicrophoneRecording:function(){return j},stopMicrophoneRecording:function(){return K},supportedLanguages:function(){return M},translate:function(){return D},version:function(){return H}});const a={"en-AU":"English (Australian)","en-GB":"English (British)","en-NZ":"English (New Zealand)","en-US":"English (US)","fr-FR":"French","fr-CA":"French (Canadian)","de-DE":"German","it-IT":"Italian","ja-JP":"Japanese","ko-KR":"Korean","pt-BR":"Portuguese (Brazilian)","es-ES":"Spanish (European)","es-US":"Spanish (US)"},r={...a,arb:"Arabic","ar-AE":"Arabic (Gulf)","ca-ES":"Catalan","yue-CN":"Chinese (Cantonese)","cmn-CN":"Chinese (Mandarin)","cs-CZ":"Czech","da-DK":"Danish","nl-BE":"Dutch (Belgian)","nl-NL":"Dutch","en-AU":"English (Australian)","en-GB":"English (British)","en-IN":"English (Indian)","en-NZ":"English (New Zealand)","en-SG":"English (Singaporean)","en-ZA":"English (South African)","en-US":"English (US)","en-GB-WLS":"English (Welsh)","fi-FI":"Finnish","fr-FR":"French","fr-BE":"French (Belgian)","fr-CA":"French (Canadian)","hi-IN":"Hindi","de-DE":"German","de-AT":"German (Austrian)","de-CH":"German (Swiss standard)","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","ko-KR":"Korean","nb-NO":"Norwegian","pl-PL":"Polish","pt-BR":"Portuguese (Brazilian)","pt-PT":"Portuguese (European)","ro-RO":"Romanian","ru-RU":"Russian","es-ES":"Spanish (Spain)","es-MX":"Spanish (Mexican)","es-US":"Spanish (US)","sv-SE":"Swedish","tr-TR":"Turkish","cy-GB":"Welsh"};class i{async start(e){let{onTranscription:n,onError:t,onComplete:a,onConnected:r}=e;try{const e=this.buildWebSocketUrl();this.ws=new WebSocket(e),this.ws.binaryType="arraybuffer",this.ws.onopen=()=>{console.log("Stream Opened:::",(new Date).toLocaleTimeString()),this.ws.send(JSON.stringify({action:"start","content-type":"audio/l16;rate=8000;channels=1",interim_results:!0,smart_formatting:!0,inactivity_timeout:-1})),r&&r()},this.ws.onmessage=e=>{const t=JSON.parse(e.data);if(t.results&&t.results.length>0&&t.results[0].final){var a;const e=t.results[0].alternatives[0];n({transcript:null===(a=e.transcript)||void 0===a?void 0:a.trim(),timestamps:e.timestamps,confidence:e.confidence,labels:t.speaker_labels})}},this.ws.onerror=e=>{t&&t(e),console.error("[NABU] StreamingV1 error",e)},this.ws.onclose=()=>{a&&a(),console.log("[NABU] [StreamingV1] closed")},this.stream=await navigator.mediaDevices.getUserMedia({audio:{sampleRate:this.sampleRate}}),this.audioContext=new AudioContext({sampleRate:this.sampleRate}),await this.audioContext.audioWorklet.addModule("./silence-processor.js");const i=this.audioContext.createMediaStreamSource(this.stream);this.processorNode=new AudioWorkletNode(this.audioContext,"silence-detector",{processorOptions:{silenceThreshold:.02,silenceDuration:300,sampleRate:this.sampleRate}}),this.processorNode.port.onmessage=e=>{const{type:n,payload:t}=e.data;"silence"!==n||this.isSilent?"speaking"===n&&this.isSilent?(this.isSilent=!1,this.stopSendingSilence()):"pcm"!==n||this.isSilent||this.ws.readyState!==WebSocket.OPEN||this.ws.send(new Uint8Array(t)):(this.isSilent=!0,this.startSendingSilence())},i.connect(this.processorNode),this.processorNode.connect(this.audioContext.destination),this.processorNode.port.postMessage({type:"start"}),console.log("Ready to stream::",(new Date).toLocaleTimeString())}catch(i){console.error("StreamingV1 start error:",i),this.onError&&this.onError(i)}}stop(){var e;this.processorNode&&this.processorNode.port.postMessage({type:"stop"}),this.stream&&this.stream.getTracks().forEach((e=>e.stop())),this.audioContext&&this.audioContext.close(),(null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&(this.ws.send(JSON.stringify({action:"stop"})),this.ws.close())}getSilenceBuffer(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;const n=this.sampleRate*e/1e3,t=new Int16Array(n);return new Uint8Array(t.buffer)}startSendingSilence(){this.stopSendingSilence();const e=this.getSilenceBuffer(100);this.silenceInterval=setInterval((()=>{this.ws.readyState===WebSocket.OPEN&&this.ws.send(e)}),100)}stopSendingSilence(){this.silenceInterval&&(clearInterval(this.silenceInterval),this.silenceInterval=null)}buildWebSocketUrl(){const e=new URLSearchParams({access_token:this.token,model:this.model,inactivity_timeout:-1});return"".concat("wss://api.us-east.speech-to-text.watson.cloud.ibm.com/instances/866db787-0272-4cdd-9ebe-110e2db04346/v1/recognize","?").concat(e.toString())}constructor({token:e,model:n="en-US_Telephony"}){this.token=e,this.model=n,this.ws=null,this.audioContext=null,this.processorNode=null,this.stream=null,this.sampleRate=8e3,this.silenceInterval=null,this.isSilent=!1}}var o=t(4223),s=t(5796),c=t(3856),l=t.n(c);class d{async start(e,n){let{onData:t,onError:a,onComplete:r,onConnected:i}=n;if(window&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext)),e){const n=await e.arrayBuffer();this.bufferStream=n;const t=await this.audioContext.decodeAudioData(n),a=t.duration;console.log("Duration::::",a),this.bufferSource=this.audioContext.createBufferSource(),this.bufferSource.buffer=t}else this.audioStreams=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}}),this.audioSource=this.audioContext.createMediaStreamSource(this.audioStreams);const s={numberOfChannels:1,sampleRate:this.audioContext.sampleRate,maxFrameCount:1*this.audioContext.sampleRate/10};try{await this.audioContext.audioWorklet.addModule("./recording-processor.js"),console.log("connected"),i&&i()}catch(m){console.log("Add module error ".concat(m))}if(this.workletNode=new AudioWorkletNode(this.audioContext,"recording-processor",{processorOptions:s}),this.workletNode.port.postMessage({message:"UPDATE_RECORDING_STATE",setRecording:!0}),e)this.bufferSource.connect(this.workletNode).connect(this.audioContext.destination),this.bufferSource.start(),console.log("starting file");else{const e=this.audioContext.createMediaStreamDestination();this.audioSource.connect(this.workletNode).connect(e)}this.workletNode.port.onmessageerror=e=>{console.log("Error receiving message from worklet ".concat(e)),a&&a(e)};const c=l().iterator(this.workletNode.port,"message"),d=e=>{const n=new ArrayBuffer(2*e.length),t=new DataView(n);for(let a=0;a<e.length;a++){const n=Math.max(-1,Math.min(1,e[a]));t.setInt16(2*a,n<0?32768*n:32767*n,!0)}return n};this.command=new o.W({LanguageCode:this.languageCode,MediaEncoding:"pcm",MediaSampleRateHertz:"48000",AudioStream:async function*(){for await(const e of c)if("SHARE_RECORDING_BUFFER"===e.data.message){const n=d(e.data.buffer[0]),t=new Uint8Array(n);yield{AudioEvent:{AudioChunk:t}}}}()});try{const e=await this.streamingClient.send(this.command);if(e.TranscriptResultStream){for await(const n of e.TranscriptResultStream){var u,g;if(null===n||void 0===n||null===(u=n.TranscriptEvent)||void 0===u?void 0:u.Transcript)for(const e of(null===n||void 0===n||null===(g=n.TranscriptEvent)||void 0===g?void 0:g.Transcript.Results)||[])if((null===e||void 0===e?void 0:e.Alternatives)&&(null===e||void 0===e?void 0:e.Alternatives[0].Items)){var h;let n="";for(let t=0;t<(null===e||void 0===e||null===(h=e.Alternatives[0].Items)||void 0===h?void 0:h.length);t++)n+=" ".concat(null===e||void 0===e?void 0:e.Alternatives[0].Items[t].Content);e.IsPartial||(n.endsWith(" .")&&(n=n.replace(" .",".")),n&&t&&t(n))}}r&&r()}}catch(p){a&&a(p)}}async stop(e){let{onStreamingStopped:n}=e;var t;(this.workletNode&&this.workletNode.port.postMessage({message:"UPDATE_RECORDING_STATE",setRecording:!1}),this.audioSource&&this.audioSource.disconnect(this.workletNode),this.bufferSource&&this.bufferSource.disconnect(this.workletNode),this.workletNode&&this.workletNode.disconnect(),this.streamingClient.destroy(),this.audioStreams)&&(null===(t=this.audioStreams.getTracks())||void 0===t||t.forEach((e=>e.stop())),this.audioStreams=null);this.audioContext&&(await this.audioContext.close(),this.audioContext=null),n&&n()}constructor({region:e,credentials:n,languageCode:t="en-US",sampleRate:a=44100}){this.region=e,this.credentials=n,this.languageCode=t,this.sampleRate=a,this.audioContext=null,this.workletNode=null,this.streamingClient=new s.I({region:e,credentials:n}),this.controller=null,this.audioStreams=null,this.bufferStream=null,this.audioSource=null,this.bufferSource=null}}var u=t(7563),g=t.n(u);const h="https://nabu-0390bfe7dc2f.herokuapp.com",m=async()=>{const e="".concat(h,"/get-creds");try{return(await g().get(e)).data}catch(n){return console.error("Error fetching creds:",n),null}};var p=t(7272),f=t(4563);class S{async translateText(e,n,t){try{const a=new p.r({Text:e,SourceLanguageCode:n,TargetLanguageCode:t});return{translation:(await this.translateClient.send(a)).TranslatedText}}catch(a){return{translationError:a}}}constructor({region:e,credentials:n}){this.region=e,this.credentials=n,this.translateClient=new f.O({region:e,credentials:n})}}t(2781);var v=t(1806),w=t(1843);class y{async audioText(e,n,t,a){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mp3";const i=new v.Q({OutputFormat:r,Text:e,VoiceId:n,Engine:t,LanguageCode:a}),{AudioStream:o}=await this.pollyClient.send(i);return o}async fetchLanguages(){return{"fr-BE":{female:{voiceId:"Isabelle",engine:"neural"}},"en-US":{female:{voiceId:"Danielle",engine:"neural"},male:{voiceId:"Gregory",engine:"neural"}},"tr-TR":{female:{voiceId:"Burcu",engine:"neural"}},"cs-CZ":{female:{voiceId:"Jitka",engine:"neural"}},"de-CH":{female:{voiceId:"Sabrina",engine:"neural"}},"es-ES":{female:{voiceId:"Lucia",engine:"neural"},male:{voiceId:"Sergio",engine:"neural"}},"es-US":{female:{voiceId:"Lupe",engine:"neural"},male:{voiceId:"Pedro",engine:"neural"}},"en-SG":{female:{voiceId:"Jasmine",engine:"neural"}},"ko-KR":{female:{voiceId:"Jihye",engine:"neural"}},"sv-SE":{female:{voiceId:"Elin",engine:"neural"}},"ru-RU":{female:{voiceId:"Tatyana",engine:"standard"},male:{voiceId:"Maxim",engine:"standard"}},"ro-RO":{female:{voiceId:"Carmen",engine:"standard"}},"pt-PT":{female:{voiceId:"Ines",engine:"neural"},male:{voiceId:"Cristiano",engine:"standard"}},"pt-BR":{female:{voiceId:"Vitoria",engine:"neural"},male:{voiceId:"Thiago",engine:"neural"}},"pl-PL":{female:{voiceId:"Ola",engine:"neural"},male:{voiceId:"Jan",engine:"standard"}},"nl-BE":{female:{voiceId:"Lisa",engine:"neural"}},"nl-NL":{male:{voiceId:"Ruben",engine:"standard"},female:{voiceId:"Laura",engine:"neural"}},"nb-NO":{female:{voiceId:"Ida",engine:"neural"}},"ja-JP":{female:{voiceId:"Kazuha",engine:"neural"},male:{voiceId:"Takumi",engine:"neural"}},"it-IT":{female:{voiceId:"Bianca",engine:"neural"},male:{voiceId:"Adriano",engine:"neural"}},"is-IS":{male:{voiceId:"Karl",engine:"standard"},female:{voiceId:"Dora",engine:"standard"}},"fr-FR":{male:{voiceId:"Remi",engine:"neural"},female:{voiceId:"Lea",engine:"neural"}},"fr-CA":{female:{voiceId:"Gabrielle",engine:"neural"},male:{voiceId:"Liam",engine:"neural"}},"es-MX":{female:{voiceId:"Mia",engine:"neural"},male:{voiceId:"Andres",engine:"neural"}},"en-GB-WLS":{male:{voiceId:"Geraint",engine:"standard"}},"en-NZ":{female:{voiceId:"Aria",engine:"neural"}},"en-ZA":{female:{voiceId:"Ayanda",engine:"neural"}},"en-IN":{female:{voiceId:"Kajal",engine:"neural"}},"hi-IN":{female:{voiceId:"Kajal",engine:"neural"}},"en-GB":{female:{voiceId:"Emma",engine:"neural"},male:{voiceId:"Brian",engine:"neural"}},"en-AU":{male:{voiceId:"Russell",engine:"standard"},female:{voiceId:"Olivia",engine:"neural"}},"de-DE":{female:{voiceId:"Vicki",engine:"neural"},male:{voiceId:"Daniel",engine:"neural"}},"da-DK":{female:{voiceId:"Sofie",engine:"neural"},male:{voiceId:"Mads",engine:"standard"}},"cy-GB":{female:{voiceId:"Gwyneth",engine:"standard"}},"cmn-CN":{female:{voiceId:"Zhiyu",engine:"neural"}},arb:{female:{voiceId:"Hala",engine:"neural"},male:{voiceId:"Zayd",engine:"neural"}},"ar-AE":{female:{voiceId:"Hala",engine:"neural"},male:{voiceId:"Zayd",engine:"neural"}},"ca-ES":{female:{voiceId:"Arlet",engine:"neural"}},"de-AT":{female:{voiceId:"Hannah",engine:"neural"}},"yue-CN":{female:{voiceId:"Hiujin",engine:"neural"}},"fi-FI":{female:{voiceId:"Suvi",engine:"neural"}},"en-IE":{female:{voiceId:"Niamh",engine:"neural"}}}}formatVoices(e){const n={},t={neural:3,standard:2,generative:1};function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return t[e.toLowerCase()]||0}function r(e,t){n[e]||(n[e]={});const r=t.Gender.toLowerCase(),i=t.Id||t.VoiceId,o=t.SupportedEngines||(t.Engine?[t.Engine]:[]),s=o.includes("neural")?"neural":o.includes("standard")?"standard":o[0]||"",c=a(s);if("female"===r){const t=n[e].female,r=a(null===t||void 0===t?void 0:t.engine);(!t||c>r)&&(n[e].female={voiceId:i,engine:s})}if("male"===r){const t=n[e].male,r=a(null===t||void 0===t?void 0:t.engine);(!t||c>r)&&(n[e].male={voiceId:i,engine:s})}}for(const[i,o]of Object.entries(e))for(const e of o)if(r(i,e),Array.isArray(e.AdditionalLanguageCodes))for(const n of e.AdditionalLanguageCodes)r(n,e);return n}async fetchVoiceAndEngine(e,n){return{voice:"",engine:""}}async getVoiceIdAndEngine(e,n){return await this.getVoices(e,n)}async getVoices(e){let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const t=await this.fetchLanguages(),{male:a,female:r}=t[e];return(a||r)&&n?"male"===n&&a?a:"female"===n&&r?r:"male"!==n||a?"female"!==n||r?void 0:a:r:{}}constructor({region:e,credentials:n,languageCode:t,gender:a}){return this.region=e,this.credentials=n,this.languageCode=t,this.gender=a,this.pollyClient=new w.z({region:e,credentials:n}),y.instance||(y.instance=this),y.instance}}new class{on(e,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(n)}emit(e,n){(this.listeners[e]||[]).forEach((e=>e(n)))}off(e,n){this.listeners[e]&&(this.listeners[e]=this.listeners[e].filter((e=>e!==n)))}constructor(){this.listeners={}}};let I,E,C={};const A=async e=>{if(console.log("[NABU] Stream Initialization::::",e),Object.keys(a).includes(e)){const{access_token:e}=await(async e=>{const n="".concat(h,"/get-token?serviceName=").concat(e);try{return(await g().get(n)).data}catch(t){return console.error("Error fetching access token:",t),null}})("stt");I=new i({token:e}),I.initializeWS(e)}},L=async e=>{let{sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:i,onError:o,onConnected:s}=e;return await O({sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:i,onError:o,onConnected:s})},N=async e=>{let{onPaused:n}=e;if(I&&I instanceof i)return await I.pause({onPaused:n})},b=async e=>{let{onResumed:n}=e;if(I&&I instanceof i)return await I.resume({onResumed:n})},k=async e=>{let{onStopped:n}=e;return I&&I instanceof i?await T({onStopped:n}):E&&E instanceof d?await R({onStopped:n}):void 0},T=async e=>{let{onStopped:n}=e;I&&I instanceof i&&await I.stop({onStreamingStopped:()=>{I=null,n()}})},R=async e=>{let{onStopped:n}=e;E&&E instanceof d&&await E.stop({onStreamingStopped:()=>{E=null,n()}})},O=async e=>{let{sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:i,onError:o,onConnected:s}=e;E=new d({region:C.region,credentials:C.credentials,languageCode:n}),await E.start(null,{onData:async e=>{if("transcriptOnly"===r)i({transcript:e});else if("translateOnly"===r){const{translation:a,translationError:r}=await P({transcript:data.transcript,sourceLanguage:n,targetLanguage:t});r?o&&o(r):i({transcript:e,translation:a})}else if("audioOnly"===r){const r=await x({transcript:e,sourceLanguage:n,targetLanguage:t,audioHeardAs:a});i(r)}},onError:e=>{o&&o("[NABU StreamingV1] error:",e)},onComplete:()=>{},onConnected:()=>{s&&s()}})},P=async e=>{let{transcript:n,sourceLanguage:t,targetLanguage:a}=e;console.log("getTranslationText: ".concat(n));const r=new S({region:C.region,credentials:C.credentials}),{translation:i,translationError:o}=await r.translateText(n,t,a);return{translation:i,translationError:o}},x=async e=>{let{transcript:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:i,onProcessed:o,onError:s}=e;return console.log("Generating translation for text: ".concat(n)),await U({transcript:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:i,onProcessed:o,onError:s})},U=async e=>{let{transcript:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:i,onProcessed:o,onError:s}=e;const{translation:c,translationError:l}=await P({transcript:n,sourceLanguage:t,targetLanguage:a});l&&s&&s({message:l}),i&&i({translation:c,translationError:l});const d=await B({text:c,targetLanguage:a,audioHeardAs:r});o&&d&&o({translation:c,audio:d})},B=async e=>{let{text:n,targetLanguage:t,audioHeardAs:a}=e;const r=new y({region:C.region,credentials:C.credentials,languageCode:t,gender:a}),{voiceId:i,engine:o}=await r.getVoiceIdAndEngine(t,a),s=await r.audioText(n,i,o,t,"mp3");return new Blob([await s.transformToByteArray()],{type:"audio/mpeg"})};const H=t(9079).env.npm_package_version,M=r,W=async e=>{let{sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:i,onError:o,onConnected:s}=e;const c=await(async e=>{let{sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:i,onError:o,onConnected:s}=e;if(!(null===C||void 0===C?void 0:C.region)){const e=await m();C={region:e.region,credentials:{accessKeyId:e.apiKey,secretAccessKey:e.secretKey}}}return await L({sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:i,onError:o,onConnected:s})})({sourceLanguage:n,targetLanguage:t,audioHeardAs:a,output:r,onProcessed:i,onError:o,onConnected:s});return c},D=async e=>{let{text:n,sourceLanguage:t,targetLanguage:a,onProcessed:r,onError:i}=e;const o=await(async e=>{let{text:n,sourceLanguage:t,targetLanguage:a,onProcessed:r,onError:i}=e;if(!(null===C||void 0===C?void 0:C.region)){const e=await m();C={region:e.region,credentials:{accessKeyId:e.apiKey,secretAccessKey:e.secretKey}}}const{translation:o,translationError:s}=await P({transcript:n,sourceLanguage:t,targetLanguage:a});s?i&&i(s):r({translation:o})})({text:n,sourceLanguage:t,targetLanguage:a,onProcessed:r,onError:i});return o},G=async e=>{let{text:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:i,onProcessed:o,onError:s}=e;const c=await(async e=>{let{text:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:i,onProcessed:o,onError:s}=e;if(!(null===C||void 0===C?void 0:C.region)){const e=await m();C={region:e.region,credentials:{accessKeyId:e.apiKey,secretAccessKey:e.secretKey}}}return await x({transcript:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:i,onProcessed:o,onError:s})})({text:n,sourceLanguage:t,targetLanguage:a,audioHeardAs:r,onTranslated:i,onProcessed:o,onError:s});return c},K=async e=>{let{onStopped:n}=e;return await(async e=>{let{onStopped:n}=e;return await k({onStopped:n})})({onStopped:n})},J=async e=>await A(e),_=async e=>{let{onPaused:n}=e;return await(async e=>{let{onPaused:n}=e;return await N({onPaused:n})})({onPaused:n})},j=async e=>{let{onResumed:n}=e;return await(async e=>{let{onResumed:n}=e;return await b({onResumed:n})})({onResumed:n})}},8504:function(e,n,t){t.d(n,{J:function(){return a}});const a="https://nabu-0390bfe7dc2f.herokuapp.com"},4289:function(e,n,t){t.d(n,{Ie:function(){return S},SQ:function(){return u},SS:function(){return f},aT:function(){return m},bE:function(){return g},e$:function(){return p},vP:function(){return h},wQ:function(){return v},yt:function(){return d}});var a=t(4095),r=t(8504);let i=null;const o=new Set,s=new Set,c=new Set,l=new Set;function d(e,n){return i||(i=new WebSocket("".concat(r.J,"?room=").concat(e,"&uid=").concat(n)),i.onopen=()=>{console.log("[NABU WS] Connected to room ".concat(e)),setInterval((()=>{i&&i.readyState===WebSocket.OPEN&&i.send("keep-alive")}),3e4)},i.onerror=t=>{console.error("[NABU WS] WebSocket error",t),i.close(),i=null,console.error("[NABU WS] WebSocket Reconnecting",t),i=new WebSocket("".concat(r.J,"?room=").concat(e,"&uid=").concat(n))},i.onclose=()=>{console.warn("[NABU WS] Disconnected"),i=null},i.onmessage=e=>{try{const n=JSON.parse(e.data);if("hand"===n.type)o.forEach((e=>e(n.uid,n.raised)));else if("chat"===n.type)s.forEach((e=>e(n.uid,n.text,n.sourceLanguage)));else if("mute"===n.type)c.forEach((e=>e(n.uid,n.muted)));else if("transcript"===n.type){a.E.getState().setActiveSpeaker(n.uid),l.forEach((e=>e(n.uid,n.transcript,n.sourceLanguage,n.audioHeardAs)))}else if("room-state"===n.type){const{raisedHands:e,mutedUsers:t}=n,r=a.E.getState();Object.entries(e||{}).forEach((e=>{let[n,t]=e;r.setHandState(n,t)})),Object.entries(t||{}).forEach((e=>{let[n,t]=e;r.setMuteState(n,t)}))}}catch(n){console.warn("[NABU WS] Invalid message",e.data)}},i)}function u(e,n){i&&i.readyState===WebSocket.OPEN&&i.send(JSON.stringify({type:"hand",uid:e,raised:n}))}function g(e,n,t){i&&i.readyState===WebSocket.OPEN&&i.send(JSON.stringify({type:"chat",uid:e,text:n,sourceLanguage:t}))}function h(e,n){i&&i.readyState===WebSocket.OPEN&&(console.log("[NABU] Sending Mute for user, ".concat(e," with state: ").concat(n)),i.send(JSON.stringify({type:"mute",uid:e,muted:n})))}function m(e,n,t,a){i&&i.readyState===WebSocket.OPEN&&i.send(JSON.stringify({type:"transcript",uid:e,transcript:n,sourceLanguage:t,audioHeardAs:a}))}function p(e){return o.add(e),()=>{o.delete(e)}}function f(e){return s.add(e),()=>{s.delete(e)}}function S(e){return c.add(e),()=>{c.delete(e)}}function v(e){return l.add(e),()=>{l.delete(e)}}},4095:function(e,n,t){t.d(n,{E:function(){return a}});const a=(0,t(2574).U)((e=>({muted:!0,videoEnabled:!1,raisedHands:{},mutedUsers:{},activeSpeakerUid:null,toggleMute:()=>e((e=>({muted:!e.muted}))),toggleVideo:()=>e((e=>({videoEnabled:!e.videoEnabled}))),raiseHand:n=>e((e=>{var t;const a=null!==(t=e.raisedHands[n])&&void 0!==t&&t;return{raisedHands:{...e.raisedHands,[n]:!a}}})),muteUser:n=>e((e=>{var t;const a=null!==(t=e.mutedUsers[n])&&void 0!==t&&t;return{mutedUsers:{...e.mutedUsers,[n]:!a}}})),setActiveSpeaker:n=>e((()=>({activeSpeakerUid:n}))),agoraInstance:null,agoraClient:null,setAgoraInstance:n=>e((()=>({agoraInstance:n}))),setAgoraClient:n=>e((()=>({agoraInstance:n}))),isChatOpen:!1,isTranscriptOpen:!1,isParticipantsOpen:!1,toggleChat:()=>e((e=>({isChatOpen:!e.isChatOpen,isParticipantsOpen:!1,isTranscriptOpen:!1}))),toggleTranscript:()=>e((e=>({isTranscriptOpen:!e.isTranscriptOpen,isParticipantsOpen:!1,isChatOpen:!1}))),toggleParticipants:()=>e((e=>({isParticipantsOpen:!e.isParticipantsOpen,isChatOpen:!1,isTranscriptOpen:!1}))),messages:[],addMessage:(n,t,a)=>e((e=>({messages:[...e.messages,{uid:n,text:t,sourceLanguage:a,time:(new Date).toLocaleTimeString()}]}))),transcripts:[],addTranscript:(n,t,a,r)=>e((e=>({transcripts:[...e.transcripts,{uid:n,transcript:t,sourceLanguage:a,audioHeardAs:r,time:(new Date).toLocaleTimeString()}]}))),meetingInfo:{},setMeetingInfo:n=>e((()=>({meetingInfo:n}))),setHandState:(n,t)=>e((e=>({raisedHands:t?{...e.raisedHands,[n]:!0}:Object.fromEntries(Object.entries(e.raisedHands).filter((e=>{let[t]=e;return t!==n})))}))),setMuteState:(n,t)=>e((e=>({mutedUsers:t?{...e.mutedUsers,[n]:!0}:Object.fromEntries(Object.entries(e.mutedUsers).filter((e=>{let[t]=e;return t!==n})))})))})))}}]);